<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Blackjack</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #121212;
            color: #fff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1596838132731-3301c3fd4317?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover;
            background-position: center;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: none;
        }

        /* Login/Signup Page */
        .auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
        }

        .auth-form {
            background-color: rgba(30, 30, 30, 0.9);
            padding: 30px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #f8d347;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 4px;
            background-color: #333;
            color: #fff;
        }

        .btn {
            background-color: #f8d347;
            color: #121212;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #e6c23e;
        }

        .auth-toggle {
            text-align: center;
            margin-top: 20px;
        }

        .auth-toggle a {
            color: #f8d347;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Menu Page */
        .menu-container {
            padding: 40px;
            text-align: center;
        }

        .menu-container h1 {
            color: #f8d347;
            margin-bottom: 40px;
        }

        .stakes-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stake-option {
            background-color: rgba(30, 30, 30, 0.9);
            padding: 30px;
            border-radius: 8px;
            width: 200px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .stake-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .stake-option h3 {
            color: #f8d347;
            margin-bottom: 10px;
        }

        .stake-option p {
            margin-bottom: 20px;
        }

        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(30, 30, 30, 0.9);
            padding: 10px 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Game Page */
        .game-container {
            padding: 20px;
            display: none;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .game-title {
            color: #f8d347;
            margin: 0;
        }

        .game-info {
            display: flex;
            gap: 20px;
        }

        .info-box {
            background-color: rgba(30, 30, 30, 0.9);
            padding: 10px 20px;
            border-radius: 4px;
            text-align: center;
        }

        .info-box h4 {
            margin: 0 0 5px 0;
            color: #f8d347;
        }

        .info-box p {
            margin: 0;
            font-weight: bold;
        }

        .game-table {
            background-color: #0a5c36;
            border-radius: 10px;
            padding: 20px;
            min-height: 400px;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
        }

        .dealer-area, .player-area {
            padding: 20px;
            min-height: 150px;
        }

        .dealer-area h3, .player-area h3 {
            color: #f8d347;
            margin-top: 0;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 120px;
        }

        .card {
            width: 80px;
            height: 120px;
            background-color: white;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: black;
            font-weight: bold;
            font-size: 24px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .card.red {
            color: red;
        }

        .card-back {
            background: linear-gradient(135deg, #d10000 25%, #8b0000 25%, #8b0000 50%, #d10000 50%, #d10000 75%, #8b0000 75%);
            background-size: 20px 20px;
            color: white;
        }

        .card-value {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 16px;
        }

        .card-suit {
            font-size: 30px;
        }

        .game-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .hit-btn {
            background-color: #4CAF50;
            color: white;
        }

        .stand-btn {
            background-color: #f44336;
            color: white;
        }

        .double-btn {
            background-color: #2196F3;
            color: white;
        }

        .deal-btn {
            background-color: #f8d347;
            color: #121212;
        }

        .message-area {
            text-align: center;
            margin-top: 20px;
            min-height: 24px;
            font-weight: bold;
            color: #f8d347;
        }

        .chip {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .chip.low {
            background-color: #4CAF50;
            border: 2px solid #2E7D32;
        }

        .chip.medium {
            background-color: #2196F3;
            border: 2px solid #0D47A1;
        }

        .chip.high {
            background-color: #f44336;
            border: 2px solid #B71C1C;
        }

        .bet-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .bet-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }

        .bet-btn:hover {
            opacity: 0.8;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .stakes-options {
                flex-direction: column;
                align-items: center;
            }
            
            .game-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .game-actions {
                flex-wrap: wrap;
            }
            
            .card {
                width: 60px;
                height: 90px;
                font-size: 18px;
            }
            
            .card-value {
                font-size: 12px;
            }
            
            .card-suit {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login/Signup Container -->
    <div class="container" id="auth-container">
        <div class="auth-container">
            <div class="auth-form" id="login-form">
                <h2>Login</h2>
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password">
                </div>
                <button class="btn" id="login-btn">Login</button>
                <div class="auth-toggle">
                    Don't have an account? <a id="show-signup">Sign up</a>
                </div>
            </div>

            <div class="auth-form" id="signup-form" style="display: none;">
                <h2>Sign Up</h2>
                <div class="form-group">
                    <label for="signup-username">Username</label>
                    <input type="text" id="signup-username" placeholder="Choose a username">
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" placeholder="Choose a password">
                </div>
                <div class="form-group">
                    <label for="signup-confirm-password">Confirm Password</label>
                    <input type="password" id="signup-confirm-password" placeholder="Confirm your password">
                </div>
                <button class="btn" id="signup-btn">Sign Up</button>
                <div class="auth-toggle">
                    Already have an account? <a id="show-login">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Container -->
    <div class="container" id="menu-container">
        <div class="user-info" id="user-info" style="display: none;">
            <span id="username-display"></span>
            <span id="balance-display"></span>
            <button class="logout-btn" id="logout-btn">Logout</button>
        </div>
        <div class="menu-container">
            <h1>Select Your Stakes</h1>
            <div class="stakes-options">
                <div class="stake-option" data-stake="low">
                    <h3>Low Stakes</h3>
                    <p>$5 - $50 bets</p>
                    <p>Perfect for beginners</p>
                    <button class="btn">Play Now</button>
                </div>
                <div class="stake-option" data-stake="medium">
                    <h3>Medium Stakes</h3>
                    <p>$50 - $500 bets</p>
                    <p>For experienced players</p>
                    <button class="btn">Play Now</button>
                </div>
                <div class="stake-option" data-stake="high">
                    <h3>High Stakes</h3>
                    <p>$500 - $5000 bets</p>
                    <p>High rollers only</p>
                    <button class="btn">Play Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Container -->
    <div class="container" id="game-container">
        <div class="user-info" id="game-user-info">
            <span id="game-username-display"></span>
            <span id="game-balance-display"></span>
            <button class="logout-btn" id="game-logout-btn">Logout</button>
        </div>
        <div class="game-container">
            <div class="game-header">
                <h2 class="game-title">Blackjack</h2>
                <div class="game-info">
                    <div class="info-box">
                        <h4>Current Bet</h4>
                        <p id="current-bet">$0</p>
                    </div>
                    <div class="info-box">
                        <h4>Stakes</h4>
                        <p id="stakes-level">Low</p>
                    </div>
                </div>
            </div>

            <div class="game-table">
                <div class="dealer-area">
                    <h3>Dealer</h3>
                    <div class="cards" id="dealer-cards"></div>
                </div>
                <div class="player-area">
                    <h3>Player</h3>
                    <div class="cards" id="player-cards"></div>
                </div>
                <div class="chip low" id="bet-chip" style="display: none;">$<span id="chip-amount">0</span></div>
            </div>

            <div class="bet-controls" id="bet-controls">
                <button class="bet-btn" data-amount="5">$5</button>
                <button class="bet-btn" data-amount="10">$10</button>
                <button class="bet-btn" data-amount="25">$25</button>
                <button class="bet-btn" data-amount="50">$50</button>
                <button class="bet-btn" data-amount="100">$100</button>
                <button class="bet-btn" id="clear-bet">Clear</button>
            </div>

            <div class="game-actions" id="game-actions">
                <button class="action-btn deal-btn" id="deal-btn">Deal</button>
                <button class="action-btn hit-btn" id="hit-btn" disabled>Hit</button>
                <button class="action-btn stand-btn" id="stand-btn" disabled>Stand</button>
                <button class="action-btn double-btn" id="double-btn" disabled>Double</button>
            </div>

            <div class="message-area" id="message-area"></div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            loggedIn: false,
            currentUser: null,
            users: JSON.parse(localStorage.getItem('blackjackUsers')) || [],
            currentStake: null,
            deck: [],
            dealerHand: [],
            playerHand: [],
            gameInProgress: false,
            currentBet: 0,
            balance: 1000 // Default balance for new users
        };

        // DOM Elements
        const authContainer = document.getElementById('auth-container');
        const menuContainer = document.getElementById('menu-container');
        const gameContainer = document.getElementById('game-container');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignup = document.getElementById('show-signup');
        const showLogin = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const stakeOptions = document.querySelectorAll('.stake-option');
        const userInfo = document.getElementById('user-info');
        const usernameDisplay = document.getElementById('username-display');
        const balanceDisplay = document.getElementById('balance-display');
        const logoutBtn = document.getElementById('logout-btn');
        const gameUserInfo = document.getElementById('game-user-info');
        const gameUsernameDisplay = document.getElementById('game-username-display');
        const gameBalanceDisplay = document.getElementById('game-balance-display');
        const gameLogoutBtn = document.getElementById('game-logout-btn');
        const currentBetDisplay = document.getElementById('current-bet');
        const stakesLevelDisplay = document.getElementById('stakes-level');
        const dealerCards = document.getElementById('dealer-cards');
        const playerCards = document.getElementById('player-cards');
        const betChip = document.getElementById('bet-chip');
        const chipAmount = document.getElementById('chip-amount');
        const betControls = document.getElementById('bet-controls');
        const betButtons = document.querySelectorAll('.bet-btn');
        const clearBetBtn = document.getElementById('clear-bet');
        const gameActions = document.getElementById('game-actions');
        const dealBtn = document.getElementById('deal-btn');
        const hitBtn = document.getElementById('hit-btn');
        const standBtn = document.getElementById('stand-btn');
        const doubleBtn = document.getElementById('double-btn');
        const messageArea = document.getElementById('message-area');

        // Initialize the app
        function init() {
            authContainer.style.display = 'flex';
            menuContainer.style.display = 'none';
            gameContainer.style.display = 'none';
            
            // Check if user is already logged in (for page refresh)
            const loggedInUser = localStorage.getItem('blackjackCurrentUser');
            if (loggedInUser) {
                const user = gameState.users.find(u => u.username === loggedInUser);
                if (user) {
                    loginUser(user);
                }
            }
            
            setupEventListeners();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Auth form toggles
            showSignup.addEventListener('click', () => {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            });
            
            showLogin.addEventListener('click', () => {
                signupForm.style.display = 'none';
                loginForm.style.display = 'block';
            });
            
            // Login button
            loginBtn.addEventListener('click', handleLogin);
            
            // Signup button
            signupBtn.addEventListener('click', handleSignup);
            
            // Stake selection
            stakeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const stake = option.getAttribute('data-stake');
                    selectStake(stake);
                });
            });
            
            // Logout buttons
            logoutBtn.addEventListener('click', logout);
            gameLogoutBtn.addEventListener('click', logout);
            
            // Bet buttons
            betButtons.forEach(btn => {
                if (btn.id !== 'clear-bet') {
                    btn.addEventListener('click', () => {
                        const amount = parseInt(btn.getAttribute('data-amount'));
                        placeBet(amount);
                    });
                }
            });
            
            clearBetBtn.addEventListener('click', clearBet);
            
            // Game action buttons
            dealBtn.addEventListener('click', deal);
            hitBtn.addEventListener('click', hit);
            standBtn.addEventListener('click', stand);
            doubleBtn.addEventListener('click', double);
        }

        // Handle login
        function handleLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            
            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }
            
            const user = gameState.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                loginUser(user);
            } else {
                showMessage('Invalid username or password', 'error');
            }
        }

        // Handle signup
        function handleSignup() {
            const username = document.getElementById('signup-username').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const confirmPassword = document.getElementById('signup-confirm-password').value.trim();
            
            if (!username || !password || !confirmPassword) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }
            
            if (gameState.users.some(u => u.username === username)) {
                showMessage('Username already exists', 'error');
                return;
            }
            
            const newUser = {
                username,
                password,
                balance: 1000 // Starting balance
            };
            
            gameState.users.push(newUser);
            localStorage.setItem('blackjackUsers', JSON.stringify(gameState.users));
            
            showMessage('Account created successfully! Please login.', 'success');
            showLogin.click();
            
            // Clear signup form
            document.getElementById('signup-username').value = '';
            document.getElementById('signup-password').value = '';
            document.getElementById('signup-confirm-password').value = '';
        }

        // Login user
        function loginUser(user) {
            gameState.loggedIn = true;
            gameState.currentUser = user;
            gameState.balance = user.balance;
            
            localStorage.setItem('blackjackCurrentUser', user.username);
            
            // Update UI
            usernameDisplay.textContent = user.username;
            balanceDisplay.textContent = `$${user.balance}`;
            gameUsernameDisplay.textContent = user.username;
            
            authContainer.style.display = 'none';
            menuContainer.style.display = 'flex';
            userInfo.style.display = 'flex';
        }

        // Logout
        function logout() {
            // Save user data
            if (gameState.currentUser) {
                const userIndex = gameState.users.findIndex(u => u.username === gameState.currentUser.username);
                if (userIndex !== -1) {
                    gameState.users[userIndex].balance = gameState.balance;
                    localStorage.setItem('blackjackUsers', JSON.stringify(gameState.users));
                }
            }
            
            // Reset game state
            gameState.loggedIn = false;
            gameState.currentUser = null;
            gameState.currentStake = null;
            gameState.gameInProgress = false;
            gameState.currentBet = 0;
            
            localStorage.removeItem('blackjackCurrentUser');
            
            // Reset UI
            authContainer.style.display = 'flex';
            menuContainer.style.display = 'none';
            gameContainer.style.display = 'none';
            userInfo.style.display = 'none';
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            
            // Clear forms
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
        }

        // Select stake level
        function selectStake(stake) {
            gameState.currentStake = stake;
            
            // Update UI based on stake level
            switch (stake) {
                case 'low':
                    stakesLevelDisplay.textContent = 'Low Stakes';
                    break;
                case 'medium':
                    stakesLevelDisplay.textContent = 'Medium Stakes';
                    break;
                case 'high':
                    stakesLevelDisplay.textContent = 'High Stakes';
                    break;
            }
            
            // Adjust bet buttons based on stake level
            const betAmounts = {
                low: [5, 10, 25, 50, 100],
                medium: [50, 100, 250, 500, 1000],
                high: [500, 1000, 2500, 5000, 10000]
            };
            
            const buttons = document.querySelectorAll('.bet-btn[data-amount]');
            buttons.forEach((btn, index) => {
                btn.textContent = `$${betAmounts[stake][index]}`;
                btn.setAttribute('data-amount', betAmounts[stake][index]);
            });
            
            // Update chip color based on stake
            betChip.className = 'chip';
            betChip.classList.add(stake);
            
            // Show game container
            menuContainer.style.display = 'none';
            gameContainer.style.display = 'flex';
            
            // Reset any existing game
            resetGame();
        }

        // Place a bet
        function placeBet(amount) {
            if (gameState.gameInProgress) return;
            
            const newBet = gameState.currentBet + amount;
            
            if (newBet > gameState.balance) {
                showMessage('Not enough balance for this bet', 'error');
                return;
            }
            
            gameState.currentBet = newBet;
            updateUI();
            
            betChip.style.display = 'flex';
            chipAmount.textContent = gameState.currentBet;
        }

        // Clear bet
        function clearBet() {
            if (gameState.gameInProgress) return;
            
            gameState.currentBet = 0;
            updateUI();
            
            betChip.style.display = 'none';
        }

        // Deal cards
        function deal() {
            if (gameState.gameInProgress || gameState.currentBet <= 0) return;
            
            // Deduct bet from balance
            gameState.balance -= gameState.currentBet;
            updateUI();
            
            // Initialize game
            gameState.gameInProgress = true;
            gameState.deck = createDeck();
            gameState.dealerHand = [drawCard(), drawCard()];
            gameState.playerHand = [drawCard(), drawCard()];
            
            // Update UI
            renderHands();
            updateActionButtons();
            
            // Check for blackjack
            if (calculateHandValue(gameState.playerHand) === 21) {
                // Player has blackjack, check dealer
                const dealerValue = calculateHandValue(gameState.dealerHand);
                
                if (dealerValue === 21) {
                    // Push
                    endGame('push');
                } else {
                    // Player wins 3:2
                    endGame('blackjack');
                }
            }
            
            showMessage('Game in progress - Make your move');
        }

        // Player hits
        function hit() {
            if (!gameState.gameInProgress) return;
            
            gameState.playerHand.push(drawCard());
            renderHands();
            
            const playerValue = calculateHandValue(gameState.playerHand);
            
            if (playerValue > 21) {
                // Player busts
                endGame('lose');
            } else if (playerValue === 21) {
                // Player can't hit on 21
                stand();
            }
            
            updateActionButtons();
        }

        // Player stands
        function stand() {
            if (!gameState.gameInProgress) return;
            
            // Dealer draws until 17 or higher
            let dealerValue = calculateHandValue(gameState.dealerHand);
            
            while (dealerValue < 17) {
                gameState.dealerHand.push(drawCard());
                dealerValue = calculateHandValue(gameState.dealerHand);
            }
            
            renderHands(true); // Show dealer's full hand
            
            const playerValue = calculateHandValue(gameState.playerHand);
            
            if (dealerValue > 21) {
                // Dealer busts, player wins
                endGame('win');
            } else if (dealerValue > playerValue) {
                // Dealer wins
                endGame('lose');
            } else if (playerValue > dealerValue) {
                // Player wins
                endGame('win');
            } else {
                // Push
                endGame('push');
            }
        }

        // Player doubles down
        function double() {
            if (!gameState.gameInProgress || gameState.currentBet * 2 > gameState.balance) return;
            
            // Double the bet
            gameState.balance -= gameState.currentBet;
            gameState.currentBet *= 2;
            updateUI();
            
            // Take one card
            gameState.playerHand.push(drawCard());
            renderHands();
            
            const playerValue = calculateHandValue(gameState.playerHand);
            
            if (playerValue > 21) {
                // Player busts
                endGame('lose');
            } else {
                // Stand after doubling
                stand();
            }
        }

        // Create a shuffled deck
        function createDeck() {
            const suits = ['♠', '♣', '♥', '♦'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const deck = [];
            
            for (const suit of suits) {
                for (const value of values) {
                    deck.push({ suit, value });
                }
            }
            
            // Shuffle the deck
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        }

        // Draw a card from the deck
        function drawCard() {
            return gameState.deck.pop();
        }

        // Calculate hand value
        function calculateHandValue(hand) {
            let value = 0;
            let aces = 0;
            
            for (const card of hand) {
                if (card.value === 'A') {
                    value += 11;
                    aces++;
                } else if (['K', 'Q', 'J'].includes(card.value)) {
                    value += 10;
                } else {
                    value += parseInt(card.value);
                }
            }
            
            // Adjust for aces
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            
            return value;
        }

        // Render hands
        function renderHands(showDealerCard = false) {
            // Clear current cards
            dealerCards.innerHTML = '';
            playerCards.innerHTML = '';
            
            // Render dealer's hand
            gameState.dealerHand.forEach((card, index) => {
                if (index === 0 && !showDealerCard && gameState.gameInProgress) {
                    // Hide dealer's first card during game
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card card-back';
                    dealerCards.appendChild(cardElement);
                } else {
                    renderCard(card, dealerCards);
                }
            });
            
            // Render player's hand
            gameState.playerHand.forEach(card => {
                renderCard(card, playerCards);
            });
            
            // Show dealer's value if revealed
            if (showDealerCard) {
                const dealerValue = calculateHandValue(gameState.dealerHand);
                document.querySelector('.dealer-area h3').textContent = `Dealer (${dealerValue})`;
            } else {
                document.querySelector('.dealer-area h3').textContent = 'Dealer';
            }
            
            // Show player's value
            const playerValue = calculateHandValue(gameState.playerHand);
            document.querySelector('.player-area h3').textContent = `Player (${playerValue})`;
        }

        // Render a single card
        function renderCard(card, container) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            
            if (card.suit === '♥' || card.suit === '♦') {
                cardElement.classList.add('red');
            }
            
            const valueElement = document.createElement('div');
            valueElement.className = 'card-value';
            valueElement.textContent = card.value;
            
            const suitElement = document.createElement('div');
            suitElement.className = 'card-suit';
            suitElement.textContent = card.suit;
            
            cardElement.appendChild(valueElement);
            cardElement.appendChild(suitElement);
            
            container.appendChild(cardElement);
        }

        // End the game
        function endGame(result) {
            gameState.gameInProgress = false;
            
            // Show dealer's full hand
            renderHands(true);
            
            // Calculate payout
            let payout = 0;
            let message = '';
            
            switch (result) {
                case 'win':
                    payout = gameState.currentBet * 2;
                    message = 'You win!';
                    break;
                case 'lose':
                    payout = 0;
                    message = 'You lose.';
                    break;
                case 'push':
                    payout = gameState.currentBet;
                    message = 'Push.';
                    break;
                case 'blackjack':
                    payout = gameState.currentBet * 2.5; // 3:2 payout
                    message = 'Blackjack! You win 3:2!';
                    break;
            }
            
            // Update balance
            gameState.balance += payout;
            gameState.currentBet = 0;
            
            // Update UI
            updateUI();
            updateActionButtons();
            showMessage(message);
            
            // Save user data
            if (gameState.currentUser) {
                const userIndex = gameState.users.findIndex(u => u.username === gameState.currentUser.username);
                if (userIndex !== -1) {
                    gameState.users[userIndex].balance = gameState.balance;
                    localStorage.setItem('blackjackUsers', JSON.stringify(gameState.users));
                }
            }
        }

        // Reset game state
        function resetGame() {
            gameState.deck = [];
            gameState.dealerHand = [];
            gameState.playerHand = [];
            gameState.gameInProgress = false;
            gameState.currentBet = 0;
            
            // Clear UI
            dealerCards.innerHTML = '';
            playerCards.innerHTML = '';
            document.querySelector('.dealer-area h3').textContent = 'Dealer';
            document.querySelector('.player-area h3').textContent = 'Player';
            betChip.style.display = 'none';
            messageArea.textContent = '';
            
            updateUI();
            updateActionButtons();
        }

        // Update action buttons based on game state
        function updateActionButtons() {
            if (gameState.gameInProgress) {
                // Game in progress
                dealBtn.disabled = true;
                hitBtn.disabled = false;
                standBtn.disabled = false;
                
                // Only allow double on first move
                const canDouble = gameState.playerHand.length === 2 && 
                                 gameState.currentBet * 2 <= gameState.balance;
                doubleBtn.disabled = !canDouble;
                
                betControls.style.display = 'none';
            } else {
                // Game not in progress
                dealBtn.disabled = gameState.currentBet <= 0;
                hitBtn.disabled = true;
                standBtn.disabled = true;
                doubleBtn.disabled = true;
                
                betControls.style.display = 'flex';
            }
        }

        // Update UI elements
        function updateUI() {
            currentBetDisplay.textContent = `$${gameState.currentBet}`;
            balanceDisplay.textContent = `$${gameState.balance}`;
            gameBalanceDisplay.textContent = `$${gameState.balance}`;
            
            if (gameState.currentBet > 0) {
                chipAmount.textContent = gameState.currentBet;
            }
        }

        // Show message
        function showMessage(text, type = 'info') {
            messageArea.textContent = text;
            messageArea.style.color = type === 'error' ? '#ff4d4d' : '#f8d347';
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
