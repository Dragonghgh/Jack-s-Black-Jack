<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Blackjack</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0a5c36;
            color: white;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
        }
        .screen {
            display: none;
        }
        .active {
            display: block;
        }
        button {
            background-color: #f8d347;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #e6c23e;
        }
        .card {
            display: inline-block;
            width: 60px;
            height: 90px;
            background-color: white;
            color: black;
            border-radius: 5px;
            margin: 5px;
            line-height: 90px;
            font-size: 24px;
        }
        .red {
            color: red;
        }
        .card-back {
            background: repeating-linear-gradient(
                45deg,
                #d10000,
                #d10000 10px,
                #8b0000 10px,
                #8b0000 20px
            );
            color: white;
        }
        .hand {
            min-height: 100px;
            margin: 20px 0;
        }
        .chip {
            display: inline-block;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #f8d347;
            line-height: 40px;
            margin: 5px;
            cursor: pointer;
        }
        .message {
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
            min-height: 27px;
        }
        input {
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Screen -->
        <div id="login-screen" class="screen active">
            <h1>Welcome to Blackjack</h1>
            <div id="login-form">
                <h2>Login</h2>
                <input type="text" id="username" placeholder="Username"><br>
                <input type="password" id="password" placeholder="Password"><br>
                <button id="login-btn">Login</button>
                <p>Don't have an account? <a href="#" id="show-signup">Sign up</a></p>
            </div>
            <div id="signup-form" style="display:none">
                <h2>Sign Up</h2>
                <input type="text" id="new-username" placeholder="Username"><br>
                <input type="password" id="new-password" placeholder="Password"><br>
                <input type="password" id="confirm-password" placeholder="Confirm Password"><br>
                <button id="signup-btn">Sign Up</button>
                <p>Already have an account? <a href="#" id="show-login">Login</a></p>
            </div>
        </div>

        <!-- Menu Screen -->
        <div id="menu-screen" class="screen">
            <h1>Select Your Stakes</h1>
            <div class="stakes">
                <button class="stake-btn" data-stake="low">Low Stakes ($5-$100)</button><br>
                <button class="stake-btn" data-stake="medium">Medium Stakes ($50-$500)</button><br>
                <button class="stake-btn" data-stake="high">High Stakes ($500-$5000)</button>
            </div>
            <div class="user-info">
                <p>Welcome, <span id="display-username"></span> | Balance: $<span id="balance">1000</span></p>
                <button id="logout-btn">Logout</button>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <h1>Blackjack</h1>
            <div class="user-info">
                <p><span id="game-username"></span> | Balance: $<span id="game-balance">1000</span> | Bet: $<span id="current-bet">0</span></p>
                <button id="game-logout-btn">Leave Game</button>
            </div>
            
            <div class="game-area">
                <h3>Dealer</h3>
                <div id="dealer-hand" class="hand"></div>
                
                <h3>Player</h3>
                <div id="player-hand" class="hand"></div>
                
                <div class="message" id="message"></div>
                
                <div id="betting-controls">
                    <h3>Place Your Bet</h3>
                    <div id="chips">
                        <div class="chip" data-amount="5">5</div>
                        <div class="chip" data-amount="10">10</div>
                        <div class="chip" data-amount="25">25</div>
                        <div class="chip" data-amount="50">50</div>
                        <div class="chip" data-amount="100">100</div>
                    </div>
                    <button id="clear-bet">Clear Bet</button>
                    <button id="deal-btn">Deal</button>
                </div>
                
                <div id="game-controls" style="display:none">
                    <button id="hit-btn">Hit</button>
                    <button id="stand-btn">Stand</button>
                    <button id="double-btn">Double</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const game = {
            user: null,
            users: JSON.parse(localStorage.getItem('blackjackUsers')) || [],
            stake: null,
            deck: [],
            dealerHand: [],
            playerHand: [],
            bet: 0,
            balance: 1000,
            gameActive: false
        };

        // DOM elements
        const screens = {
            login: document.getElementById('login-screen'),
            menu: document.getElementById('menu-screen'),
            game: document.getElementById('game-screen')
        };

        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const showSignup = document.getElementById('show-signup');
        const showLogin = document.getElementById('show-login');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const stakeBtns = document.querySelectorAll('.stake-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const gameLogoutBtn = document.getElementById('game-logout-btn');
        const usernameDisplay = document.getElementById('display-username');
        const balanceDisplay = document.getElementById('balance');
        const gameUsernameDisplay = document.getElementById('game-username');
        const gameBalanceDisplay = document.getElementById('game-balance');
        const currentBetDisplay = document.getElementById('current-bet');
        const dealerHandDisplay = document.getElementById('dealer-hand');
        const playerHandDisplay = document.getElementById('player-hand');
        const messageDisplay = document.getElementById('message');
        const chips = document.querySelectorAll('.chip');
        const clearBetBtn = document.getElementById('clear-bet');
        const dealBtn = document.getElementById('deal-btn');
        const hitBtn = document.getElementById('hit-btn');
        const standBtn = document.getElementById('stand-btn');
        const doubleBtn = document.getElementById('double-btn');
        const bettingControls = document.getElementById('betting-controls');
        const gameControls = document.getElementById('game-controls');

        // Event listeners
        showSignup.addEventListener('click', () => {
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
        });

        showLogin.addEventListener('click', () => {
            signupForm.style.display = 'block';
            loginForm.style.display = 'none';
        });

        loginBtn.addEventListener('click', login);
        signupBtn.addEventListener('click', signup);
        logoutBtn.addEventListener('click', logout);
        gameLogoutBtn.addEventListener('click', leaveGame);

        stakeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                game.stake = btn.dataset.stake;
                showScreen('game');
                updateStake();
            });
        });

        chips.forEach(chip => {
            chip.addEventListener('click', () => {
                const amount = parseInt(chip.dataset.amount);
                placeBet(amount);
            });
        });

        clearBetBtn.addEventListener('click', clearBet);
        dealBtn.addEventListener('click', deal);
        hitBtn.addEventListener('click', hit);
        standBtn.addEventListener('click', stand);
        doubleBtn.addEventListener('click', double);

        // Functions
        function showScreen(screen) {
            Object.values(screens).forEach(s => s.classList.remove('active'));
            screens[screen].classList.add('active');
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = game.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                game.user = user;
                game.balance = user.balance;
                updateUserDisplay();
                showScreen('menu');
            } else {
                showMessage('Invalid username or password');
            }
        }

        function signup() {
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const confirm = document.getElementById('confirm-password').value;
            
            if (password !== confirm) {
                showMessage("Passwords don't match");
                return;
            }
            
            if (game.users.some(u => u.username === username)) {
                showMessage("Username already exists");
                return;
            }
            
            const newUser = { username, password, balance: 1000 };
            game.users.push(newUser);
            localStorage.setItem('blackjackUsers', JSON.stringify(game.users));
            
            game.user = newUser;
            game.balance = 1000;
            updateUserDisplay();
            showScreen('menu');
            
            // Switch back to login form and clear inputs
            showLogin.click();
            document.getElementById('new-username').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
        }

        function logout() {
            saveUser();
            game.user = null;
            showScreen('login');
        }

        function leaveGame() {
            saveUser();
            showScreen('menu');
            resetGame();
        }

        function saveUser() {
            if (game.user) {
                const userIndex = game.users.findIndex(u => u.username === game.user.username);
                if (userIndex !== -1) {
                    game.users[userIndex].balance = game.balance;
                    localStorage.setItem('blackjackUsers', JSON.stringify(game.users));
                }
            }
        }

        function updateUserDisplay() {
            if (game.user) {
                usernameDisplay.textContent = game.user.username;
                balanceDisplay.textContent = game.balance;
                gameUsernameDisplay.textContent = game.user.username;
                gameBalanceDisplay.textContent = game.balance;
            }
        }

        function updateStake() {
            const chipValues = {
                low: [5, 10, 25, 50, 100],
                medium: [50, 100, 250, 500, 1000],
                high: [500, 1000, 2500, 5000, 10000]
            };
            
            chips.forEach((chip, index) => {
                chip.textContent = chipValues[game.stake][index];
                chip.dataset.amount = chipValues[game.stake][index];
            });
        }

        function placeBet(amount) {
            if (game.gameActive) return;
            
            const newBet = game.bet + amount;
            
            if (newBet > game.balance) {
                showMessage("Not enough balance");
                return;
            }
            
            game.bet = newBet;
            currentBetDisplay.textContent = game.bet;
        }

        function clearBet() {
            if (game.gameActive) return;
            game.bet = 0;
            currentBetDisplay.textContent = game.bet;
        }

        function deal() {
            if (game.gameActive || game.bet <= 0) return;
            
            game.balance -= game.bet;
            gameBalanceDisplay.textContent = game.balance;
            
            game.gameActive = true;
            game.deck = createDeck();
            game.dealerHand = [drawCard(), drawCard()];
            game.playerHand = [drawCard(), drawCard()];
            
            renderHands();
            bettingControls.style.display = 'none';
            gameControls.style.display = 'block';
            
            // Check for blackjack
            if (calculateHandValue(game.playerHand) === 21) {
                const dealerValue = calculateHandValue(game.dealerHand);
                
                if (dealerValue === 21) {
                    endGame('push');
                } else {
                    endGame('blackjack');
                }
            }
        }

        function hit() {
            if (!game.gameActive) return;
            
            game.playerHand.push(drawCard());
            renderHands();
            
            const playerValue = calculateHandValue(game.playerHand);
            
            if (playerValue > 21) {
                endGame('lose');
            } else if (playerValue === 21) {
                stand();
            }
        }

        function stand() {
            if (!game.gameActive) return;
            
            // Reveal dealer's card
            renderHands(true);
            
            // Dealer draws until 17 or higher
            while (calculateHandValue(game.dealerHand) < 17) {
                game.dealerHand.push(drawCard());
                renderHands(true);
            }
            
            const playerValue = calculateHandValue(game.playerHand);
            const dealerValue = calculateHandValue(game.dealerHand);
            
            if (dealerValue > 21) {
                endGame('win');
            } else if (dealerValue > playerValue) {
                endGame('lose');
            } else if (playerValue > dealerValue) {
                endGame('win');
            } else {
                endGame('push');
            }
        }

        function double() {
            if (!game.gameActive || game.bet * 2 > game.balance) return;
            
            game.balance -= game.bet;
            game.bet *= 2;
            gameBalanceDisplay.textContent = game.balance;
            currentBetDisplay.textContent = game.bet;
            
            game.playerHand.push(drawCard());
            renderHands();
            
            const playerValue = calculateHandValue(game.playerHand);
            
            if (playerValue > 21) {
                endGame('lose');
            } else {
                stand();
            }
        }

        function createDeck() {
            const suits = ['♠', '♣', '♥', '♦'];
            const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const deck = [];
            
            for (const suit of suits) {
                for (const value of values) {
                    deck.push({ suit, value });
                }
            }
            
            // Shuffle
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        }

        function drawCard() {
            return game.deck.pop();
        }

        function calculateHandValue(hand) {
            let value = 0;
            let aces = 0;
            
            for (const card of hand) {
                if (card.value === 'A') {
                    value += 11;
                    aces++;
                } else if (['K', 'Q', 'J'].includes(card.value)) {
                    value += 10;
                } else {
                    value += parseInt(card.value);
                }
            }
            
            while (value > 21 && aces > 0) {
                value -= 10;
                aces--;
            }
            
            return value;
        }

        function renderHands(showDealerCard = false) {
            dealerHandDisplay.innerHTML = '';
            playerHandDisplay.innerHTML = '';
            
            // Dealer's hand
            game.dealerHand.forEach((card, index) => {
                if (index === 0 && !showDealerCard && game.gameActive) {
                    dealerHandDisplay.innerHTML += '<div class="card card-back"></div>';
                } else {
                    renderCard(card, dealerHandDisplay);
                }
            });
            
            // Player's hand
            game.playerHand.forEach(card => {
                renderCard(card, playerHandDisplay);
            });
        }

        function renderCard(card, container) {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            if (card.suit === '♥' || card.suit === '♦') {
                cardElement.classList.add('red');
            }
            cardElement.textContent = card.value + card.suit;
            container.appendChild(cardElement);
        }

        function endGame(result) {
            game.gameActive = false;
            renderHands(true);
            
            let message = '';
            let payout = 0;
            
            switch (result) {
                case 'win':
                    payout = game.bet * 2;
                    message = 'You win!';
                    break;
                case 'lose':
                    payout = 0;
                    message = 'You lose.';
                    break;
                case 'push':
                    payout = game.bet;
                    message = 'Push.';
                    break;
                case 'blackjack':
                    payout = game.bet * 2.5;
                    message = 'Blackjack! You win 3:2!';
                    break;
            }
            
            game.balance += payout;
            game.bet = 0;
            gameBalanceDisplay.textContent = game.balance;
            currentBetDisplay.textContent = game.bet;
            
            showMessage(message);
            bettingControls.style.display = 'block';
            gameControls.style.display = 'none';
            
            saveUser();
        }

        function resetGame() {
            game.deck = [];
            game.dealerHand = [];
            game.playerHand = [];
            game.bet = 0;
            game.gameActive = false;
            
            dealerHandDisplay.innerHTML = '';
            playerHandDisplay.innerHTML = '';
            currentBetDisplay.textContent = game.bet;
            bettingControls.style.display = 'block';
            gameControls.style.display = 'none';
            showMessage('');
        }

        function showMessage(msg) {
            messageDisplay.textContent = msg;
        }

        // Initialize
        showScreen('login');
    </script>
</body>
</html>
